"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("ffi-napi"),n=require("readline"),i=(e=require("word-wrap"))&&"object"==typeof e&&"default"in e?e.default:e;function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){var n,i;e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n=e,i=t,(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(n,i)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var c,l=t.Library("kernel32",{GetStdHandle:["int",["int"]],SetConsoleTextAttribute:["int",["int","int"]],GetConsoleScreenBufferInfo:["int",["int","pointer"]]});!function(e){e[e.FOREGROUND_BLUE=1]="FOREGROUND_BLUE",e[e.FOREGROUND_GREEN=2]="FOREGROUND_GREEN",e[e.FOREGROUND_RED=4]="FOREGROUND_RED",e[e.FOREGROUND_INTENSITY=8]="FOREGROUND_INTENSITY",e[e.BACKGROUND_BLUE=16]="BACKGROUND_BLUE",e[e.BACKGROUND_GREEN=32]="BACKGROUND_GREEN",e[e.BACKGROUND_RED=64]="BACKGROUND_RED",e[e.BACKGROUND_INTENSITY=128]="BACKGROUND_INTENSITY",e[e.COMMON_LVB_LEADING_BYTE=256]="COMMON_LVB_LEADING_BYTE",e[e.COMMON_LVB_TRAILING_BYTE=512]="COMMON_LVB_TRAILING_BYTE",e[e.COMMON_LVB_GRID_HORIZONTAL=1024]="COMMON_LVB_GRID_HORIZONTAL",e[e.COMMON_LVB_GRID_LVERTICAL=2048]="COMMON_LVB_GRID_LVERTICAL",e[e.COMMON_LVB_GRID_RVERTICAL=4096]="COMMON_LVB_GRID_RVERTICAL",e[e.COMMON_LVB_REVERSE_VIDEO=16384]="COMMON_LVB_REVERSE_VIDEO",e[e.COMMON_LVB_UNDERSCORE=32768]="COMMON_LVB_UNDERSCORE"}(c||(c={}));var h=function(){function e(e){this.color=e,this._is_applyed=!1}e.create=function(t){return new e("string"==typeof t?Number(t.split("[")[1].split("m")[0]):t)};var t=e.prototype;return t.toString=function(){return"[color: "+this.color+"]|"},e.getCurrentColor=function(){var e=l.GetStdHandle(-11),t=Buffer.alloc(22);return l.GetConsoleScreenBufferInfo(e,t),t.readInt32LE(8)},e.applyColor=function(e){var t=l.GetStdHandle(-11),n=Buffer.alloc(22);return l.GetConsoleScreenBufferInfo(t,n),l.SetConsoleTextAttribute(t,e),n.readInt32LE(8)},t.toggle=function(){this._is_applyed?this.end():this.apply(),this._is_applyed=!this._is_applyed},t.apply=function(){e.applyColor(this.color)},t.end=function(){e.applyColor(e._default_attributes)},e}();function d(e){return Math.max(e,-e)}function a(e,t){var n=d(t-e.length)/2;return" ".repeat(n+(e.length%2==1?1:0))+e+" ".repeat(n)}h._default_attributes=h.getCurrentColor();var p=function(){function e(e,t){void 0===t&&(t={}),this._label=e,this.ITEM_TYPE="DEFAULT_ITEM",this._is_disabled=!1,this.propertys=Object.assign({is_countless:!1,onClicked:function(){},onKeyDown:function(e){},disabled:!1},t),this.propertys.disabled&&this.disable()}var t=e.prototype;return t.disable=function(){this._is_disabled=!0,this._menu&&this._menu.render()},t.enable=function(){this._is_disabled=!1,this._menu&&this._menu.render()},t.onKeyDown=function(e){this.propertys.onKeyDown.bind(this)(e)},t.onClicked=function(){return this.propertys.onClicked.bind(this).apply(void 0,arguments)},t.render=function(e){throw new Error("`Item.render(width)` Method not implemented.")},o(e,[{key:"label",get:function(){return this._label},set:function(e){this._label=e}},{key:"isDisabled",get:function(){return this._is_disabled}},{key:"menu",get:function(){if(!this._menu)throw new Error("Cannot access `MenuItem.menu` property before append the item to the menu.");return this._menu},set:function(e){this._menu||(this._menu=e)}},{key:"id",get:function(){return this._id},set:function(e){var t;null!=(t=this._id)&&t.length||(this._id=e)}}]),e}(),f=function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n)||this}return s(t,e),t.prototype.render=function(e){return a(this.label,e)},t}(p),m=function(e){function t(t,n){var i,r;return void 0===n&&(n={}),(r=e.call(this,t,n)||this)._checked=!1,r._checked=null!=(i=n.checked)&&i,r}s(t,e);var n=t.prototype;return n.render=function(e){var t=this._checked?"[X]":"[ ]",n=d(e-this.label.length)/2;return" ".repeat(n+(this.label.length%2==1?1:0))+this.label+" ".repeat(n-t.length)+t},n.onClicked=function(){this._checked=!this._checked,e.prototype.onClicked.call(this,this._checked)},o(t,[{key:"checked",get:function(){return this._checked}}]),t}(p);function y(e,t){process.stdout.cursorTo(e,t)}function b(e,t){return e.replace(/\{([^\}]*)\}/g,(function(e,n){var i;return null!=(i=t[n])?i:""}))}var g=function(){function e(e){void 0===e&&(e={}),this._selected_item_idx=-1,this._items=[],this._message="",this._is_menu_locked=!1,this._is_menu_hidden=!1,this.propertys=Object.assign({left_column_style:"|",right_column_style:"|",header_style:"-",bottom_row_style:"-",between_items_style:" ",padding:2,between_items_padding:1,message_item_selected:!1,message_item_format:"Item ${index} selected",minimal_width:10},e)}var t=e.prototype;return t.showMessage=function(e,t){var n=this;void 0===t&&(t=-1),this._message=e,this.render(),t>0&&(clearTimeout(this._message_timeout_tmo),this._message_timeout_tmo=setTimeout((function(){n.clearMessage(),n.render()}),t))},t.clearMessage=function(){this.showMessage("",-1)},t._on_key_down=function(e,t){this._is_menu_locked||("down"==t.name?(this.moveSelection(!1),this.propertys.message_item_selected?this.showMessage(b(this.propertys.message_item_format,{index:this._selected_item_idx})):this.render()):"up"==t.name?(this.moveSelection(!0),this.propertys.message_item_selected?this.showMessage(b(this.propertys.message_item_format,{index:this._selected_item_idx})):this.render()):"left"===t.name&&(this.current_selected_item&&this.current_selected_item.onClicked(),this.render()))},t.lock=function(){this._is_menu_locked=!0},t.unlock=function(){this._is_menu_locked=!1},t.clear=function(){throw new Error("`Menu.clear()` Method not implemented.")},t._hide=function(){throw new Error("`Menu._hide()` Method not implemented.")},t._show=function(){throw new Error("`Menu._show()` Method not implemented.")},t.hide=function(){this._is_menu_hidden||(this._is_menu_hidden=!0,this._hide())},t.show=function(){this._is_menu_hidden&&(this._is_menu_hidden=!1,this._show())},t.append=function(e,t){"number"==typeof t?this._items.splice(t,0,e):t instanceof p?this._items.splice(this._items.indexOf(t),0,e):this._items.push(e),e.id=e.ITEM_TYPE+": "+this._items.indexOf(e),e.menu=this},t.remove=function(e){this._items.splice(this._items.indexOf(e),1)},t.moveSelection=function(e){var t;this._selected_item_idx+=e?-1:1,this._selected_item_idx<0?this._selected_item_idx=this._items.length-1:this._selected_item_idx>=this._items.length&&(this._selected_item_idx=0),null!=(t=this.current_selected_item)&&t.isDisabled&&this.moveSelection(e)},t.disable=function(e){var t;"number"==typeof e&&(e=this._items[e]),null==(t=e)||null==t.disable||t.disable()},t.enable=function(e){var t;"number"==typeof e&&(e=this._items[e]),null==(t=e)||null==t.enable||t.enable()},t.isEnabled=function(e){var t,n;return"number"==typeof e&&(e=this._items[e]),"boolean"==typeof(null==(t=e)?void 0:t.isDisabled)&&!(null!=(n=e)&&n.isDisabled)},t.isDisabled=function(e){var t,n;return"number"==typeof e&&(e=this._items[e]),"boolean"==typeof(null==(t=e)?void 0:t.isDisabled)&&(null==(n=e)?void 0:n.isDisabled)},t.currentItemIndex=function(){return this._selected_item_idx},t.getItem=function(e){return this._items[e]},t.initialize=function(){throw new Error("`Menu.render()` Method not implemented.")},t.render=function(){throw new Error("`Menu.render()` Method not implemented.")},o(e,[{key:"current_selected_item",get:function(){return this._items[this._selected_item_idx]}},{key:"selected_item_idx",get:function(){return this._selected_item_idx}}]),e}();function v(e,t){void 0===t&&(t={});var n,i,r=0,o=(n=l.GetStdHandle(-11),i=Buffer.alloc(22),l.GetConsoleScreenBufferInfo(n,i),{x:i.readInt16LE(4),y:i.readInt16LE(6)}).y;t.cache||(t.cache={buffer_cache:[]});for(var s=[];r<e.length;){s[r]=0;var _=e[r],u=-1;for(y(0,r+o);_[1].length>++u;){var c=_[1][u],d=c instanceof Array;s[r]+=d?c[1].length:c.length,d&&h.applyColor(c[0]),process.stdout.write(d?c[1]:c),d&&h.applyColor(h._default_attributes)}s[r]<t.cache.buffer_cache[r]&&process.stdout.write(" ".repeat(t.cache.buffer_cache[r]-s[r]+1)),r++}if(s.length<t.cache.buffer_cache.length)for(var a=s.length;a<t.cache.buffer_cache.length;a++)y(0,r++),process.stdout.write(" ".repeat(t.cache.buffer_cache[a]));return y(0,o),{buffer_cache:s}}g.MENU_TYPE="DEFAULT_MENU";var E=function(e){function t(t){var n;return(n=e.call(this,"")||this)._label=t,n}s(t,e);var n=t.prototype;return n.render=function(e,t){var n=a(this._label,e);return[n.length,this._render("-".repeat(n.length+2*t.padding),t,!0),this._render(n,t),this._render("-".repeat(n.length+2*t.padding),t,!0)]},n._render=function(e,t,n){return[0,[t.left_column_style+(n?"":" ".repeat(t.padding))+e+(n?"":" ".repeat(t.padding))+t.right_column_style]]},t}(p),O=function(e){function t(){return e.call(this,"")||this}s(t,e);var n=t.prototype;return n.render=function(e,t,n){var r=this,o=i(e,{width:t-2*n.padding}).split("\n").map((function(e){return a(e,t)})),s=o.reduce((function(e,t){return Math.max(e.length,t.length)}));return"string"==typeof s&&(s=s.length),[this._render("-".repeat(s+2*n.padding),n,!0)].concat(o.map((function(e){return r._render(e,n)})),[this._render("-".repeat(s+2*n.padding),n,!0)])},n._render=function(e,t,n){return[0,[t.left_column_style+(n?"":" ".repeat(t.padding))+e+(n?"":" ".repeat(t.padding))+t.right_column_style]]},t}(p),R=n.createInterface({input:process.stdin,output:process.stdout}),M=function(e){function t(t,n){var i;return void 0===t&&(t="Default Menu Title"),void 0===n&&(n={}),(i=e.call(this,n)||this)._title=t,i._cache=void 0,i._menu_header=new E(i._title),i._menu_header.menu=_(i),i._menu_footer=new O,i._menu_footer.menu=_(i),i}s(t,e);var n=t.prototype;return n.initialize=function(){this.moveSelection(!1),process.stdin.on("keypress",this._on_key_down.bind(this))},n.dispose=function(){process.stdin.off("keypress",this._on_key_down),this.lock(),this.hide()},n._hide=function(){if(this._cache){for(var e,t=[],n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,void 0):void 0}}(e))){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this._cache.buffer_cache);!(e=n()).done;)t.push([0,[" ".repeat(e.value)]]);v(t),y(0,0)}},n._show=function(){this.render()},n.render=function(e){if(void 0===e&&(e=this.propertys.minimal_width),!this._is_menu_hidden){var t=[],n=this._menu_header.render(e,this.propertys),i=n[0],r=n.slice(1),o=this._menu_footer.render(this._message,e=i,this.propertys);for(var s in this._items){var _=this._items[s],u=s==this._selected_item_idx,c=_.render(e);if(c.length>e)return this.render(c.length);if(t.push(this._render(c,u,_)),s!=this._items.length-1)for(var l=0;l<this.propertys.between_items_padding;l++)t.push(this._render(this.propertys.between_items_style.repeat(e),!1))}this._cache=v([].concat(r,t,o),{curser_under_screen:!0,cache:this._cache})}},n._render=function(e,t,n){var i;return[0,[null!=(i=this.propertys.left_column_style)?i:"|"].concat(t?[[c.BACKGROUND_BLUE|c.BACKGROUND_GREEN|c.BACKGROUND_RED," ".repeat(this.propertys.padding)+e+" ".repeat(this.propertys.padding)]]:[" ".repeat(this.propertys.padding),null!=n&&n.isDisabled?[8,e]:e," ".repeat(this.propertys.padding)],[this.propertys.right_column_style+(t?" <--":"")])]},t}(g),w=function(e){function t(t,n,i){var r;return void 0===n&&(n=new M(t)),void 0===i&&(i={}),(r=e.call(this,t,i)||this)._render_menu=n,r._render_menu.lock(),r._render_menu.append(new f("Return",{onClicked:function(){r.hide()}})),r._render_menu.initialize(),r}s(t,e);var n=t.prototype;return n.render=function(e){var t=this.label,n=d(e-t.length)/2;return" ".repeat(n+(t.length%2==1?1:0))+t+" ".repeat(n-"[<]".length)+"[<]"},n.show=function(){this.menu.lock(),this.menu.hide(),this._render_menu.show(),this._render_menu.unlock(),this._render_menu.render()},n.hide=function(){var e=this;this._render_menu.lock(),this._render_menu.hide(),process.nextTick((function(){e.menu.unlock(),e.menu.show()}))},n.onClicked=function(){e.prototype.onClicked.call(this),this.show()},o(t,[{key:"subMenu",get:function(){return this._render_menu}}]),t}(p);module.exports=M,module.exports.Button=f,module.exports.CheckButton=m,module.exports.SubMenu=w,module.exports.Menu=M,module.exports.RL=R,exports.Button=f,exports.CheckButton=m,exports.Menu=M,exports.RL=R,exports.SubMenu=w;
//# sourceMappingURL=console-menu.js.cjs.production.min.js.map
